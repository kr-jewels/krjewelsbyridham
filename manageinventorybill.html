<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>KR by Ridham - Bill</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script>
    let cart = [];

    function renderTable() {
      const tbody = document.getElementById('billTableBody');
      tbody.innerHTML = '';

      let totalItems = 0;
      let totalPrice = 0;

      cart.forEach((item) => {
        totalItems++;
        totalPrice += parseFloat(item.sellingPrice);
        const row = `<tr>
          <td class='p-2 border'>${item.productCode}</td>
          <td class='p-2 border'>â‚¹${item.sellingPrice}</td>
          <td class='p-2 border'>${item.status}</td>
        </tr>`;
        tbody.insertAdjacentHTML('beforeend', row);
      });

      document.getElementById('totalItems').textContent = totalItems;
      document.getElementById('totalPrice').textContent = `â‚¹${totalPrice.toFixed(2)}`;
    }

    async function submitData() {
      const name = document.getElementById('customerName').value.trim();
      const contact = document.getElementById('customerContact').value.trim();

      const payload = cart.map(item => ({
        timestamp: new Date().toISOString(),
        customerName: name,
        customerContact: contact,
        productCode: item.productCode,
        sellingPrice: item.sellingPrice,
        status: item.status
      }));

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbykh-8vOv1McWwRTkaJX8jPHUyB346epVNXSmtGSh8zHvAfkM5RKO5OpuC6I_grTZ5b/exec', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            origin: window.location.origin, 
            data: payload 
          })
        });

        if (response.ok) {
          alert('Bill submitted successfully!');
          localStorage.removeItem('eagleCart');
          window.location.href = 'manageinventoryindex.html';
        } else {
          alert('Submission failed. Please try again.');
        }
      } catch (error) {
        alert('Network error. Please check your internet connection.');
      }
    }

    window.onload = () => {
      const savedCart = localStorage.getItem('eagleCart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
        renderTable();
      }
    };
  </script>
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">ðŸ§¾ Customer Bill - KR by Ridham</h1>

    <div class="max-w-2xl mx-auto bg-gray-800 p-6 rounded-xl mb-6">
      <label class="block mb-2">Customer Name (optional)</label>
      <input id="customerName" type="text" class="w-full p-2 mb-4 rounded bg-gray-700 text-white">

      <label class="block mb-2">Customer Contact (optional)</label>
      <input id="customerContact" type="text" class="w-full p-2 mb-4 rounded bg-gray-700 text-white">
    </div>

    <div class="overflow-x-auto mb-6">
      <table class="min-w-full table-auto border border-gray-600">
        <thead>
          <tr class="bg-gray-700">
            <th class="p-2 border">Product Code</th>
            <th class="p-2 border">Selling Price</th>
            <th class="p-2 border">Status</th>
          </tr>
        </thead>
        <tbody id="billTableBody"></tbody>
      </table>
    </div>

    <div class="text-right max-w-2xl mx-auto">
      <p class="text-lg">Total Items: <span id="totalItems">0</span></p>
      <p class="text-lg">Total Price: <span id="totalPrice">â‚¹0.00</span></p>
      <button onclick="submitData()" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded">Submit Bill</button>
    </div>
  </div>
</body>
</html>